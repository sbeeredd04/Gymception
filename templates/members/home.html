{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Welcome to Gymception!</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/brands.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/solid.css' %}" rel="stylesheet" type="text/css">
    <!-- Font Awesome CDN link for backup if local files fail to load -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">

    <!-- htmx websocket-->
    <script src="https://unpkg.com/htmx.org@1.9.12/dist/ext/ws.js"></script>

</head>

<script>
  function updateWorkouts() {
      fetch("{% url 'get_recent_workouts' %}")
      .then(response => response.json())
      .then(data => {
          let workoutsList = document.getElementById('workouts-list');
          workoutsList.innerHTML = '';
          data.workouts.forEach(workout => {
              workoutsList.innerHTML += `<li>${workout.equipment_name} for ${workout.duration} on ${workout.start_time}</li>`;
          });
      })
      .catch(error => console.error('Error:', error));
  }
  
  // Call updateWorkouts initially and also set it to update periodically if needed
  updateWorkouts();
  </script>

  
<body hx-ext="ws" ws-connect="/ws/notifications/">


  <script>
    const ws = new WebSocket('ws://' + window.location.host + '/ws/notifications/');
    ws.onmessage = function(event) {
        const data = JSON.parse(event.data);
        const notificationArea = document.getElementById('notification-area'); // Make sure to have this div in your HTML
        notificationArea.innerHTML += data.message; // Append new notifications
    };
  </script>
  <div id="notification-area"></div>

<div class="main-container">

  <div class="circles-container">
    <div class="circle1" id="right"></div> <!-- Circle on the right -->
    <div class="circle2" id="bottom"></div> <!-- Circle on the bottom -->
    <div class="circle3" id="left"></div> <!-- Circle on the left -->
    <div class="circle4" id="top"></div> <!-- Circle on the top -->
    <div class="circle5" id="center"></div> <!-- Circle on the center -->
  </div>

  <div class="all-container">

    <div class="nav-bar-container">

      <div class="nav-bar-logo">
        <h1><span class="gym">Gym</span><span class="ception">ception</span></h1>
      </div>

      <div class="nav-bar-links">

        <div class="dropdown">
          <button class="dropbtn">Menu</button>
          <div class="dropdown-content">
            <a href="{% url 'home' %}">Home</a>
            {% if user.is_authenticated %}
              <a href="{% url 'profile' %}">Profile</a>
              <form action="{% url 'logout' %}" method="post" style="display: inline;">
                  {% csrf_token %}
                  <input type="submit" value="Log Out" class="dropdown-link-button">
              </form>
            {% else %}
              <a href="{% url 'login' %}">Log In</a>
              <a href="{% url 'signup' %}">Sign Up</a>
            {% endif %}
          </div>          
        </div>
    
      </div>
    
    </div>

    <div class="image-container">
      <img class="main-image" src="{% static 'Images/logo.png' %}" alt="Gymception Logo">
    </div>

    <div class="home-container">
      {% if user.is_authenticated %}
        <div class="welcome-text">
          <h1>Welcome back, {{ user.username }}!</h1>
          <p>Here at Gymception, we strive to provide you with the best workout experience possible. Our application is here to help you reach your goals. Sign up today and start your fitness journey with us!</p>
        </div>
      {% else %}
        <div class="welcome-text">
          <h1>Welcome to Gymception!</h1>
          <p>Here at Gymception, we strive to provide you with the best workout experience possible. Our application is here to help you reach your goals. Sign up today and start your fitness journey with us!</p>
        </div>
      {% endif %}

      <div class="main-page-button-container">
        <button onclick="window.location='{% url 'list-equipment' %}';" class="equipment-button">
          Equipments <i class="fa-solid fa-dumbbell"></i>
        </button> 
      </div>

      <div class="workout-list-container">
        <h2>Recent Workouts:</h2>
        <ul>
            {% for workout in recent_workouts %}
                <li>
                    <a href="{% url 'equipment-detail' workout.equipment.id %}">
                        {{ workout.equipment.name }} for {{ workout.duration }} on {{ workout.start_time|date:"Y-m-d H:i" }}
                    </a>
                </li>
            {% empty %}
                <li>No recent workouts.</li>
            {% endfor %}
        </ul>
      </div>
     

    </div>

  </div>
    
</div>

  <script src="{% static 'js/websocket_handler.js' %}"></script>
</body>

</html>
